# nginx.conf
# Este arquivo será copiado para /etc/nginx/nginx.conf dentro do container

worker_processes auto;

events {
    worker_connections 1024;
}

# Configuração do módulo RTMP
rtmp {
    server {
        listen 1935; # Porta para receber o stream RTMP
        chunk_size 4096;

        # Definição da aplicação 'live' para o seu stream de câmera
        application live {
            live on; # Habilita streaming ao vivo
            record off; # Desabilita gravação do stream (para economizar espaço e evitar problemas de disco)
        }
    }
}

# Configuração do servidor HTTP para retransmissão FLV
http {
    include       mime.types;
    default_type  application/octet-stream;

    sendfile        on;
    keepalive_timeout  65;

    server {
        listen 80; # Porta HTTP dentro do container (será mapeada para 8080 na VPS)

        # Endpoint para o stream FLV. O nome 'celular_flv' DEVE corresponder
        # ao que você envia do seu celular (rtmp://.../live/celular_flv)
        # e ao que você acessa no Google Colab (http://.../live/celular_flv).
        location /live/celular_flv {
            flv_live on; # Habilita retransmissão FLV ao vivo
        }

        # Opcional: Página de status RTMP para monitoramento.
        # Acessível via http://SEU_IP_DA_VPS:8080/stat
        location /stat {
            rtmp_stat all;
            # A imagem tiangolo/nginx-rtmp coloca o stat.xsl em /etc/nginx/html por padrão
            rtmp_stat_stylesheet stat.xsl; 
        }
        location /stat.xsl {
            root /etc/nginx/html;
        }
    }
}
