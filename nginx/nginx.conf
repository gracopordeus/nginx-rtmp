worker_processes auto;
pid /tmp/nginx.pid;

events {
    worker_connections 1024;
}

# Bloco para protocolos de Camada 4 (TCP/UDP)
stream {
    # Servidor que ouve o tráfego SRT na porta UDP 10000
    server {
        listen 10000 udp;

        # Habilita o modo SRT "ao vivo"
        srt_live on;
        
        # Pega o stream SRT recebido e o "empurra" para nosso servidor RTMP local
        # O $streamid será o que você configurar no OBS como "Stream ID"
        push rtmp://127.0.0.1:1935/live/$streamid;
    }
}

# Bloco RTMP que agora ouve apenas internamente (localhost)
rtmp {
    server {
        listen 127.0.0.1:1935; # Ouve apenas conexões locais vindas do bloco 'stream'
        chunk_size 4096;

        application live {
            live on;
            record off;

            # Converte o stream recebido para HLS (sem alterações aqui)
            hls on;
            hls_path /tmp/hls;
            hls_fragment 3s;
            hls_playlist_length 60s;
        }
    }
}

# Bloco HTTP para servir a página e o stream (sem alterações aqui)
http {
    root /usr/local/nginx/html; # Novo caminho raiz do NGINX compilado
    include /usr/local/nginx/conf/mime.types;

    server {
        listen 80;
        server_name localhost;

        location / {
            index index.html;
            add_header Cache-Control "no-cache";
        }

        location /hls {
            alias /tmp/hls;
            add_header Cache-Control "no-cache";
            add_header Access-Control-Allow-Origin *;
        }
    }
}
